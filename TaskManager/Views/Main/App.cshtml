@using Task = TaskManager.Models.Task
@model TaskManager.Models.Task

<nav class="navbar navbar-expand-lg">
	<div class="container-fluid">
		<div class="d-flex">
			<a class="btn btn-outline-dark me-2" asp-action="App">
				<img class="icon" src="~/icons/home.ico"/>
			</a>
			<form class="d-flex" asp-action="Find">
				<input class="form-control me-2" type="search" name="description">
				<button class="btn btn-outline-dark" type="submit">Найти</button>
			</form>
			<ul class="navbar-nav">
				<li class="nav-item" title="Фильтр">
					<div class="dropdown">
						<a class="btn btn-outline-dark dropdown-toggle ms-2" data-bs-toggle="dropdown">
							<img class="icon" src="~/icons/calendar.ico" alt="calendar"/>
						</a>
						<ul class="dropdown-menu">
							<li><a class="dropdown-item" asp-action="FilterByDay">День</a></li>
							<li><a class="dropdown-item" asp-action="FilterByWeek">Неделя</a></li>
							<li><a class="dropdown-item" asp-action="FilterByMonth">Месяц</a></li>
							<li><a class="dropdown-item" asp-action="FilterByYear">Год</a></li>
						</ul>
					</div>
				</li>
				<li class="nav-item" title="Сортировка">
					<div class="dropdown">
						<a class="btn btn-outline-dark dropdown-toggle ms-2" data-bs-toggle="dropdown">
							<img class="icon" src="~/icons/filter.ico" alt="filter"/>
						</a>
						<ul class="dropdown-menu">
							<li><a class="dropdown-item" asp-action="SortByPriority">Приоритет</a></li>
							<li><a class="dropdown-item" asp-action="SortByDate">Конечная дата</a></li>
						</ul>
					</div>
				</li>
			</ul>
		</div>
		<ul class="navbar-nav">
			<li class="nav-item">
				<a class="nav-link me-2" asp-action="Add"><img class="icon" src="~/icons/add.ico" alt="add"/></a>
			</li>
			<li class="nav-item">
				<a class="nav-link me-2" data-bs-toggle="modal" data-bs-target="#editModal"><img class="icon" src="~/icons/edit.ico" alt="edit"/></a>
			</li>
			<li class="nav-item">
				<a class="nav-link me-2" data-bs-toggle="modal" data-bs-target="#removeModal"><img class="icon" src="~/icons/remove.ico" alt="remove"/></a>
			</li>
		</ul>
	</div>
</nav>
<div class="container-fluid d-flex">
	<div id="allTasks" class="container border border-dark">
		<div class="d-flex flex-column">
			@foreach (Task task in ViewBag.Tasks)
			{
				<div class=" d-flex flex-column mb-3">
					<div>
						<span>@task.Description</span>
						до
						<span>@task.EndDate.ToShortDateString()</span>
					</div>
					<div>
						@if (task.Subtasks.Any())
						{
							<span>Подзадачи:</span>
							<ul class="mb-0">
								@foreach (Subtask subtask in task.Subtasks)
								{
									<li>@subtask.Description</li>
								}
							</ul>
						}
					</div>
					<div>
						@task.Priority приоритет
					</div>
				</div>
			}
		</div>
	</div>
	<div id="completedTodayTasks" class="container border-top border border-dark">
		@foreach (Task task in ViewBag.User.Tasks)
		{
			if (task.IsFinished && task.FinishDate.Date == DateTime.Today)
			{
				<span>@task.Description</span>
			}
		}
	</div>
</div>
<div id="editModal" class="modal fade" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<input type="button" class="btn btn-close" data-bs-dismiss="modal"/>
			</div>
			<div class="modal-body">
				<form id="editForm" method="post" asp-action="Edit">
					<div class="mb-3">
						<select id="editSelect" class="form-select" asp-for="Id">
							@foreach (Task task in ViewBag.User.Tasks)
							{
								<option value="@task.Id">@task.Description</option>
							}
						</select>
					</div>
					<button type="submit" class="btn btn-outline-dark">Редактировать</button>
				</form>
			</div>
		</div>
	</div>
</div>
<div id="removeModal" class="modal fade" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<input type="button" class="btn btn-close" data-bs-dismiss="modal"/>
			</div>
			<div class="modal-body">
				<form id="removeForm" method="post" asp-action="Remove">
					<div class="mb-3">
						<select class="form-select mb-3" asp-for="Id">
							@foreach (Task task in ViewBag.User.Tasks)
							{
								<option value="@task.Id">@task.Description</option>
							}
						</select>
					</div>
					<button type="submit" class="btn btn-outline-dark">Удалить</button>
				</form>
			</div>
		</div>
	</div>
</div>

@section navItems {
	<li class="nav-item">
		<a class="nav-link" asp-controller="Authentication" asp-action="SignOut">Выход</a>
	</li>
}

@section scripts {
	<script src="~/lib/jquery/jquery/dist/jquery.min.js"></script>
	<script src="~/scripts/resetScripts.js"></script>
	<script src="~/scripts/dateScripts.js"></script>
	<script src="~/scripts/subtaskScripts.js"></script>
	<script src="~/scripts/hashtagScripts.js"></script>
	<script src="~/scripts/attachmentScripts.js"></script>
	<script src="~/scripts/editScripts.js"></script>
	<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
	<script src="~/lib/jquery/jquery-validation/dist/jquery.validate.min.js"></script>
	<script src="~/lib/jquery/jquery-validation-unobtrusive/dist/jquery.validate.unobtrusive.min.js"></script>
}